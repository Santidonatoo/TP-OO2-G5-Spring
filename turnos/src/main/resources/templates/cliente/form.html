<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <title th:text="${clienteRequestDTO.idPersona != null} ? 'Editar Cliente' : 'Nuevo Cliente'">Formulario Clientes</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/form.css}">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fechaInput = document.querySelector('input[type="date"]');
            if (fechaInput) {
                const today = new Date().toISOString().split('T')[0];
                fechaInput.setAttribute('max', today);

                fechaInput.addEventListener('input', function() {
                    const selectedDate = new Date(this.value);
                    const currentDate = new Date();
                    currentDate.setHours(0, 0, 0, 0);
                    if (selectedDate > currentDate) {
                        this.value = '';
                        alert('No se pueden seleccionar fechas futuras');
                    }
                });

                fechaInput.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowUp' || e.key === 'ArrowRight') {
                        const currentValue = this.value;
                        setTimeout(() => {
                            const newValue = this.value;
                            const selectedDate = new Date(newValue);
                            const currentDate = new Date();
                            currentDate.setHours(0, 0, 0, 0);
                            if (selectedDate > currentDate) {
                                this.value = currentValue;
                            }
                        }, 0);
                    }
                });
            }
        });
    </script>
</head>
<body>

<form th:action="${clienteRequestDTO.idPersona != null} ? @{/cliente/update/{idPersona}(idPersona=${clienteRequestDTO.idPersona})} : @{/cliente/save}" 
      method="post" th:object="${clienteRequestDTO}">
    <h1 th:text="${clienteRequestDTO.idPersona != null} ? 'Editar Cliente' : 'Nuevo Cliente'"></h1>
    <input type="hidden" th:if="${clienteRequestDTO.idPersona != null}" th:field="*{idPersona}" />

    <div class="input-group">
        <label>Nombre:</label>
        <input type="text" th:field="*{nombre}" placeholder="Ej: Juan" required />
        <div th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></div>
    </div>

    <div class="input-group">
        <label>Apellido:</label>
        <input type="text" th:field="*{apellido}" placeholder="Ej: Pérez" required />
        <div th:if="${#fields.hasErrors('apellido')}" th:errors="*{apellido}"></div>
    </div>

    <div class="input-group">
        <label>DNI:</label>
        <input type="number" th:field="*{dni}" placeholder="Ej: 12345678" required />
        <div th:if="${#fields.hasErrors('dni')}" th:errors="*{dni}"></div>
    </div>

    <div class="input-group" th:if="${clienteRequestDTO.idPersona == null}">
        <label>Fecha de nacimiento:</label>
        <input type="date" th:field="*{fechaDeNacimiento}" 
               th:max="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}" required />
        <div th:if="${#fields.hasErrors('fechaDeNacimiento')}" th:errors="*{fechaDeNacimiento}"></div>
    </div>

    <fieldset>
        <legend>Información de Contacto</legend>

        <div class="input-group">
            <label>Email:</label>
            <input type="email" th:field="*{contacto.email}" placeholder="ejemplo@correo.com" required />
            <div th:if="${#fields.hasErrors('contacto.email')}" th:errors="*{contacto.email}"></div>
        </div>

        <div class="input-group">
            <label>Teléfono:</label>
            <input type="text" th:field="*{contacto.telefono}" placeholder="Ej: +54 11 1234-5678" required />
            <div th:if="${#fields.hasErrors('contacto.telefono')}" th:errors="*{contacto.telefono}"></div>
        </div>
    </fieldset>

    <button type="submit">Guardar Cliente</button>
    <div class="volver-link">
        <a th:href="@{/cliente/admin/list}">Volver</a>
    </div>
</form>

</body>
</html>
