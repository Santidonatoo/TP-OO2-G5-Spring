<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title th:text="${empleadoRequestDTO.idPersona != null} ? 'Editar Empleado' : 'Nuevo Empleado'">Formulario Empleados</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/form.css}">
	<script>
				document.addEventListener('DOMContentLoaded', function() {
			    	const fechaInput = document.querySelector('input[type="date"]');
			        if (fechaInput) {
			        	// Establecer la fecha máxima
			           	const today = new Date().toISOString().split('T')[0];
			            fechaInput.setAttribute('max', today);
			               
			            // Prevenir selección de fechas futuras
			            fechaInput.addEventListener('input', function() {
			            	const selectedDate = new Date(this.value);
			                const currentDate = new Date();
			                currentDate.setHours(0, 0, 0, 0);
			                   
			                if (selectedDate > currentDate) {
			                	this.value = '';
			                    alert('No se pueden seleccionar fechas futuras');
			                }
			       	});
			               
			        // Prevenir navegación con teclado a fechas futuras
			        fechaInput.addEventListener('keydown', function(e) {
			        	// Prevenir el uso de flechas para ir a fechas futuras
			            if (e.key === 'ArrowUp' || e.key === 'ArrowRight') {
			            	const currentValue = this.value;
			                setTimeout(() => {
			                	const newValue = this.value;
			                    const selectedDate = new Date(newValue);
			                    const currentDate = new Date();
			                    currentDate.setHours(0, 0, 0, 0);
			                           
			                    if (selectedDate > currentDate) {
			                    	this.value = currentValue;
			                    }
			                }, 0);
			          	}
			     	});
			  	}
			});
		</script>
</head>
<body>



<form th:action="${empleadoRequestDTO.idPersona != null} ? @{/empleado/update/{idPersona}(idPersona=${empleadoRequestDTO.idPersona})} : @{/empleado/save}" 
      method="post" th:object="${empleadoRequestDTO}">
    <h1 th:text="${empleadoRequestDTO.idPersona != null} ? 'Editar Empleado' : 'Nuevo Empleado'"></h1>
    <input type="hidden" th:if="${empleadoRequestDTO.idPersona != null}" th:field="*{idPersona}" />

    <div class="input-group">
        <label>Nombre:</label>
        <input type="text" th:field="*{nombre}" placeholder="Ingresa el nombre" required />
        <div th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></div>
    </div>

    <div class="input-group">
        <label>Apellido:</label>
        <input type="text" th:field="*{apellido}" placeholder="Ingresa el apellido" required />
        <div th:if="${#fields.hasErrors('apellido')}" th:errors="*{apellido}"></div>
    </div>

    <div class="input-group">
        <label>DNI:</label>
        <input type="number" th:field="*{dni}" placeholder="Ejemplo: 12345678" required />
        <div th:if="${#fields.hasErrors('dni')}" th:errors="*{dni}"></div>
    </div>
    
    <div th:if="${empleadoRequestDTO.idPersona == null}" class="input-group">
        <label>Fecha de nacimiento:</label>
        <input type="date" th:field="*{fechaDeNacimiento}" th:value="${#temporals.format(empleadoRequestDTO.fechaDeNacimiento, 'yyyy-MM-dd')}" required />
        <div th:if="${#fields.hasErrors('fechaDeNacimiento')}" th:errors="*{fechaDeNacimiento}"></div>
    </div>
    
    <div class="input-group">
        <label>Puesto:</label>
        <input type="text" th:field="*{puesto}" placeholder="Ejemplo: Desarrollador Frontend" required />
        <div th:if="${#fields.hasErrors('puesto')}" th:errors="*{puesto}"></div>
    </div>
    
    <div th:if="${empleadoRequestDTO.idPersona == null}">
        <div class="input-group">
            <label>Nombre de usuario:</label>
            <input type="text" th:field="*{username}" placeholder="Elige un nombre de usuario" required />
            <div th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
        </div>
        
        <div class="input-group">
            <label>Contraseña:</label>
            <input type="password" th:field="*{password}" placeholder="Ingresa una contraseña segura" required />
            <div th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
        </div>
    </div>
	
	<fieldset>
	     <legend>Información de Contacto</legend>
	        
	     <div class="input-group">
	         <label>Email:</label>
	         <input type="email" th:field="*{contacto.email}" placeholder="ejemplo@correo.com" required />
	         <div th:if="${#fields.hasErrors('contacto.email')}" th:errors="*{contacto.email}"></div>
	     </div>

	     <div class="input-group">
	         <label>Teléfono:</label>
	         <input type="text" th:field="*{contacto.telefono}" placeholder="Ejemplo: +54 11 1234-5678" required />
	         <div th:if="${#fields.hasErrors('contacto.telefono')}" th:errors="*{contacto.telefono}"></div>
	     </div>
	 </fieldset>
	
	
	 <fieldset>
	     <legend>Servicios Asignados</legend>
	     <div class="servicios-container">
	         <div th:each="servicio : ${servicios}" class="servicio-item">
	             <label th:for="'servicio-' + ${servicio.idServicio}">
	                 <input type="checkbox" th:field="*{idServicios}" th:value="${servicio.idServicio}" th:id="'servicio-' + ${servicio.idServicio}" />
	                 <span th:text="${servicio.nombre} + ' (' + ${servicio.duracion} + ' min)'"></span>
	             </label>
	         </div>
	     </div>
	     <div th:if="${#fields.hasErrors('idServicios')}" th:errors="*{idServicios}"></div>
	 </fieldset>
	 
    <button type="submit">Guardar Empleado</button>
	<div class="volver-link">
    	<a th:href="@{/empleado/admin/list}">Volver a la lista</a>
	</div>
</form>



</body>
</html>